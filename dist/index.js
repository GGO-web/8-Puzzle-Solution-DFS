(()=>{"use strict";const e=[{x:0,y:-1,name:"⇐"},{x:-1,y:0,name:"⇑"},{x:0,y:1,name:"⇒"},{x:1,y:0,name:"⇓"}],t={currentState:null,moves:0,settled:0,dropped:0,depth:0,haveSolution:!1},n=(e,t,n=!0)=>{console.log(`Index of the state ${t}`);let o="";for(let t of e){const e=t.map((e=>e||" "));o+="-------------\n",o+=`| ${e[0]} | ${e[1]} | ${e[2]} |\n`}return o+="-------------\n",n&&console.log(o),o},o=e=>{let t={x:0,y:0,name:"empty"};e:for(let n=0;n<e[0].length;++n)for(let o=0;o<e.length;++o)if(null===e[n][o]){t.x=n,t.y=o;break e}return t},r=e=>e.x>=3||e.x<0||e.y>=3||e.y<0;class s{constructor(e,t,o,r,s){this.getState=()=>this.state,this.getMoves=()=>this.operator,this.getDepth=()=>this.depth||1,this.pathFromStart=()=>{let e=[],t=[],o=this;console.log(o.getDepth());do{e.push(o?.getState()),t.push(o?.getMoves()),o=o?.parent}while(o?.getDepth());e.reverse(),t.reverse();let r=1;for(const t of e)n(t,r),r++;return console.log(`Кількість переміщень: ${t.length}`),console.log(`Переміщення по порядку: ${t.join(", ")}\n`),t},this.state=e,this.parent=t,this.operator=o,this.depth=r,this.cost=s}}let l=t;const d=document.getElementById("game-depth"),c=function(e,t,n,a,i){for(;a.length;){let h=a.pop();if(h.getDepth()>=parseInt(d.value)||l.haveSolution)return t;if(l={...l,currentState:h,settled:n.size,depth:h.getDepth(),haveSolution:!1},p=h.getState(),u=e,p?.toString()===u?.toString())return l.haveSolution=!0,t;const g=o(h.getState());i.forEach((o=>{const d=h?.getState()?.map((e=>[...e])),p={x:g.x+o.x,y:g.y+o.y,name:o.name};r(p)||([d[g.x][g.y],d[p.x][p.y]]=[d[p.x][p.y],d[g.x][g.y]],l.moves++,n.get(d.toString())?l.dropped++:(a.push(new s(d,h,o.name,h.getDepth()+1,0)),n.set(d.toString(),!0),t.push({state:d,index:l.moves+1}),c(e,t,n,a,i)))}))}var p,u;return t};(()=>{let o=[];const r=document.querySelector(".next"),a=document.querySelector(".result"),i=document.querySelector(".find"),p=document.getElementById("result-content");let u=0;const h=document.getElementById("results"),g=()=>{const n=e=>{const t=[];for(let n of e.rows){const e=[];for(let t of n.cells){const n=parseInt(t.innerHTML);Number.isNaN(n)?e.push(null):e.push(n)}t.push(e)}return t},d=document.querySelector(".initial-state"),i=document.querySelector(".final-state"),p=n(d),g=n(i);u=0,l=t,h.innerHTML=null;const m=new Map;m.set(p.toString(),!0);const y=[new s(p,null,null,0,0)],x=[parseInt(document.querySelector(".directions-left")?.textContent),parseInt(document.querySelector(".directions-top")?.textContent),parseInt(document.querySelector(".directions-right")?.textContent),parseInt(document.querySelector(".directions-bottom")?.textContent)],S=e.map(((e,t)=>({...e,orderIndex:x[t]})));S.sort(((e,t)=>e.orderIndex-t.orderIndex)),o=c(g,[{state:p,index:1}],m,y,S),r.disabled=!1,a.disabled=!1};r.disabled=!0,a.disabled=!0,r?.addEventListener("click",(()=>{u>=o.length-1&&(r.disabled=!0);const e=document.createElement("table");e.className+="table table-primary table-hover table-bordered table-sm align-middle caption-top",e.style.width="200px",e.style.height="200px",e.style.textAlign="center",e.insertAdjacentHTML("afterbegin",`\n            <caption class="fw-bold text-primary">\n               Index of the state is ${o[u].index}\n            </caption>\n         `);const t=document.createElement("tbody");for(let e of o[u].state){const n=t.insertRow();for(let t of e){const e=n.insertCell();e.classList.add("align-middle"),e.innerHTML=t?String(t):" "}}e.appendChild(t),h?.appendChild(e),h.scrollTop=h.scrollHeight,n(o[u].state,o[u].index),u++})),a?.addEventListener("click",(()=>{p.innerHTML="",l.haveSolution?(console.log("Порядок переміщень для розв'язку гри в 8:"),l?.currentState?.pathFromStart(),console.log(`Кількість відвіданих станів: ${l.moves}`),console.log(`Кількість станів занесених у БД: ${l.settled}`),console.log(`Кількість відкинутих станів: ${l.dropped}`),console.log(`Глибина дерева пошуку на якій знайдено рішення: ${l.depth}`),p.insertAdjacentHTML("beforeend",`\n            <code>\n            <pre>Кількість відвіданих станів: ${l.moves}<br>Кількість станів занесених у БД: ${l.settled}<br>Кількість відкинутих станів: ${l.dropped}<br>Глибина дерева пошуку на якій знайдено рішення: ${l.depth}</pre>\n            </code>\n         `)):(console.log(`Кількість відвіданих станів: ${l.moves}`),console.log(`Кількість станів занесених у БД: ${l.settled}`),console.log(`Кількість відкинутих станів: ${l.dropped}`),console.log("Гра у 8 немає розв'язків"),p.insertAdjacentHTML("beforeend",`\n            <code>\n            <pre>Кількість відвіданих станів : ${l.moves}<br>Кількість станів занесених у БД : ${l.settled}<br>Кількість відкинутих станів : ${l.dropped}<br>Гра у 8 немає розв'язків</pre>\n            </code>\n         `))})),i?.addEventListener("click",g),d.addEventListener("change",g)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFReEMsU0FDcERTLFFBQVFDLElBQUksb0NBQW9DOEIsRUFBUXZDLFdBQ3hEUSxRQUFRQyxJQUFJLGdDQUFnQzhCLEVBQVF0QyxXQUNwRE8sUUFBUUMsSUFBSSxtREFBbUQ4QixFQUFRckMsU0FDdkVnRSxFQUFjK0IsbUJBQW1CLFlBQWEsdUVBRVYxRCxFQUFReEMsNkNBQTZDd0MsRUFBUXZDLDJDQUEyQ3VDLEVBQVF0Qyw4REFBOERzQyxFQUFRckMsaURBbkIxTk0sUUFBUUMsSUFBSSxnQ0FBZ0M4QixFQUFReEMsU0FDcERTLFFBQVFDLElBQUksb0NBQW9DOEIsRUFBUXZDLFdBQ3hEUSxRQUFRQyxJQUFJLGdDQUFnQzhCLEVBQVF0QyxXQUNwRE8sUUFBUUMsSUFBSSw0QkFDWnlELEVBQWMrQixtQkFBbUIsWUFBYSx3RUFFVDFELEVBQVF4Qyw4Q0FBOEN3QyxFQUFRdkMsNENBQTRDdUMsRUFBUXRDLDZFQStGN0ksSUFFbEJnRSxHQUFZeUIsaUJBQWlCLFFBQVNyQixHQUN0QzdCLEVBQVdrRCxpQkFBaUIsU0FBVXJCLEVBQ3pDLEVBNUhELEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sYWIxLy4vc3JjL2NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9sYWIxLy4vc3JjL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vbGFiMS8uL3NyYy9ub2RlLnRzIiwid2VicGFjazovL2xhYjEvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGZpbmFsU3RhdGUgPSBbXHJcbiAgICBbMSwgMiwgM10sXHJcbiAgICBbNCwgNSwgNl0sXHJcbiAgICBbNywgOCwgbnVsbF0sXHJcbl07XHJcbmV4cG9ydCBjb25zdCBkaXJlY3Rpb25zID0gW1xyXG4gICAgeyB4OiAwLCB5OiAtMSwgbmFtZTogXCLih5BcIiB9LFxyXG4gICAgeyB4OiAtMSwgeTogMCwgbmFtZTogXCLih5FcIiB9LFxyXG4gICAgeyB4OiAwLCB5OiAxLCBuYW1lOiBcIuKHklwiIH0sXHJcbiAgICB7IHg6IDEsIHk6IDAsIG5hbWU6IFwi4oeTXCIgfSxcclxuXTtcclxuZXhwb3J0IGNvbnN0IE1BWF9ERVBUSF9TSVpFID0gMTMwMDtcclxuZXhwb3J0IGNvbnN0IENMRUFOX1JFU1VMVCA9IHtcclxuICAgIGN1cnJlbnRTdGF0ZTogbnVsbCxcclxuICAgIG1vdmVzOiAwLFxyXG4gICAgc2V0dGxlZDogMCxcclxuICAgIGRyb3BwZWQ6IDAsXHJcbiAgICBkZXB0aDogMCxcclxuICAgIGhhdmVTb2x1dGlvbjogZmFsc2UsXHJcbn07XHJcbiIsImV4cG9ydCBmdW5jdGlvbiogZ2V0RXhlY3V0aW9uVGltZSgpIHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICB5aWVsZCAxO1xyXG4gICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoZW5kVGltZSAtIHN0YXJ0VGltZSk7XHJcbiAgICBjb25zdCBleGVjdXRpb24gPSBkaWZmLmdldFNlY29uZHMoKSArIDAuMDAxICogZGlmZi5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgIGNvbnNvbGUubG9nKGBFeGVjdXRpb24gdGltZTogJHtleGVjdXRpb259IHNlY29uZHNgKTtcclxufVxyXG5leHBvcnQgY29uc3QgZGlzcGxheUJvYXJkID0gKHN0YXRlLCBpbmRleCwgZGVidWcgPSB0cnVlKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhgSW5kZXggb2YgdGhlIHN0YXRlICR7aW5kZXh9YCk7XHJcbiAgICBsZXQgZGlzcGxheSA9IFwiXCI7XHJcbiAgICBmb3IgKGxldCByb3cgb2Ygc3RhdGUpIHtcclxuICAgICAgICBjb25zdCBjZWxscyA9IHJvdy5tYXAoKGl0ZW0pID0+ICghaXRlbSA/IFwiIFwiIDogaXRlbSkpO1xyXG4gICAgICAgIGRpc3BsYXkgKz0gXCItLS0tLS0tLS0tLS0tXFxuXCI7XHJcbiAgICAgICAgZGlzcGxheSArPSBgfCAke2NlbGxzWzBdfSB8ICR7Y2VsbHNbMV19IHwgJHtjZWxsc1syXX0gfFxcbmA7XHJcbiAgICB9XHJcbiAgICBkaXNwbGF5ICs9IFwiLS0tLS0tLS0tLS0tLVxcblwiO1xyXG4gICAgaWYgKGRlYnVnKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGRpc3BsYXkpO1xyXG4gICAgcmV0dXJuIGRpc3BsYXk7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBnZXRFbXB5Q2VsbENvb3JkcyA9IChzdGF0ZSkgPT4ge1xyXG4gICAgbGV0IGNvb3JkaW5hdGVzID0geyB4OiAwLCB5OiAwLCBuYW1lOiBcImVtcHR5XCIgfTtcclxuICAgIG91dGVyOiBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXRlWzBdLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdGF0ZS5sZW5ndGg7ICsraikge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVbaV1bal0gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzLnggPSBpO1xyXG4gICAgICAgICAgICAgICAgY29vcmRpbmF0ZXMueSA9IGo7XHJcbiAgICAgICAgICAgICAgICBicmVhayBvdXRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjb29yZGluYXRlcztcclxufTtcclxuZXhwb3J0IGNvbnN0IHN0YXRlc0FyZUVxdWFsID0gKHN0YXRlLCBzZWNvbmRTdGF0ZSkgPT4ge1xyXG4gICAgcmV0dXJuIHN0YXRlPy50b1N0cmluZygpID09PSBzZWNvbmRTdGF0ZT8udG9TdHJpbmcoKTtcclxufTtcclxuZXhwb3J0IGNvbnN0IGlzT3V0T2ZCb3JkZXIgPSAoY29vcmRzKSA9PiB7XHJcbiAgICBpZiAoY29vcmRzLnggPj0gMyB8fCBjb29yZHMueCA8IDApXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICBpZiAoY29vcmRzLnkgPj0gMyB8fCBjb29yZHMueSA8IDApXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn07XHJcbiIsImltcG9ydCB7IGRpc3BsYXlCb2FyZCB9IGZyb20gXCIuL2hlbHBlcnNcIjtcclxuZXhwb3J0IGNsYXNzIE5vZGUge1xyXG4gICAgY29uc3RydWN0b3Ioc3RhdGUsIHBhcmVudCwgb3BlcmF0b3IsIGRlcHRoLCBjb3N0KSB7XHJcbiAgICAgICAgdGhpcy5nZXRTdGF0ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldE1vdmVzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVyYXRvcjtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RGVwdGggPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlcHRoIHx8IDE7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnBhdGhGcm9tU3RhcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzdGF0ZUxpc3QgPSBbXTtcclxuICAgICAgICAgICAgbGV0IG1vdmVMaXN0ID0gW107XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXM7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJlbnROb2RlLmdldERlcHRoKCkpO1xyXG4gICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICBzdGF0ZUxpc3QucHVzaChjdXJyZW50Tm9kZT8uZ2V0U3RhdGUoKSk7XHJcbiAgICAgICAgICAgICAgICBtb3ZlTGlzdC5wdXNoKGN1cnJlbnROb2RlPy5nZXRNb3ZlcygpKTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlID0gY3VycmVudE5vZGU/LnBhcmVudDtcclxuICAgICAgICAgICAgfSB3aGlsZSAoY3VycmVudE5vZGU/LmdldERlcHRoKCkpO1xyXG4gICAgICAgICAgICBzdGF0ZUxpc3QucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgICBtb3ZlTGlzdC5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IDE7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBzdGF0ZUxpc3QpIHtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlCb2FyZChpdGVtLCBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0L/QtdGA0LXQvNGW0YnQtdC90Yw6ICR7bW92ZUxpc3QubGVuZ3RofWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0J/QtdGA0LXQvNGW0YnQtdC90L3RjyDQv9C+INC/0L7RgNGP0LTQutGDOiAke21vdmVMaXN0LmpvaW4oXCIsIFwiKX1cXG5gKTtcclxuICAgICAgICAgICAgcmV0dXJuIG1vdmVMaXN0O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xyXG4gICAgICAgIHRoaXMub3BlcmF0b3IgPSBvcGVyYXRvcjtcclxuICAgICAgICB0aGlzLmRlcHRoID0gZGVwdGg7XHJcbiAgICAgICAgdGhpcy5jb3N0ID0gY29zdDtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBDTEVBTl9SRVNVTFQsIGRpcmVjdGlvbnMgfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcclxuaW1wb3J0IHsgZGlzcGxheUJvYXJkLCBnZXRFbXB5Q2VsbENvb3JkcywgaXNPdXRPZkJvcmRlciwgc3RhdGVzQXJlRXF1YWwsIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xyXG5pbXBvcnQgeyBOb2RlIH0gZnJvbSBcIi4vbm9kZVwiO1xyXG5sZXQgcmVzdWx0cyA9IENMRUFOX1JFU1VMVDtcclxuY29uc3QgaW5wdXREZXB0aCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ2FtZS1kZXB0aFwiKTtcclxuY29uc3QgREZTID0gZnVuY3Rpb24gKGZpbmFsLCBzdGF0ZXMsIGRiLCBxdWV1ZSwgb3JkZXJlZERpcmVjdGlvbnMpIHtcclxuICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gcXVldWUucG9wKCk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZS5nZXREZXB0aCgpID49IHBhcnNlSW50KGlucHV0RGVwdGgudmFsdWUpIHx8XHJcbiAgICAgICAgICAgIHJlc3VsdHMuaGF2ZVNvbHV0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc3VsdHMgPSB7XHJcbiAgICAgICAgICAgIC4uLnJlc3VsdHMsXHJcbiAgICAgICAgICAgIGN1cnJlbnRTdGF0ZTogY3VycmVudFN0YXRlLFxyXG4gICAgICAgICAgICBzZXR0bGVkOiBkYi5zaXplLFxyXG4gICAgICAgICAgICBkZXB0aDogY3VycmVudFN0YXRlLmdldERlcHRoKCksXHJcbiAgICAgICAgICAgIGhhdmVTb2x1dGlvbjogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoc3RhdGVzQXJlRXF1YWwoY3VycmVudFN0YXRlLmdldFN0YXRlKCksIGZpbmFsKSkge1xyXG4gICAgICAgICAgICByZXN1bHRzLmhhdmVTb2x1dGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGVtcHR5Q2VsbCA9IGdldEVtcHlDZWxsQ29vcmRzKGN1cnJlbnRTdGF0ZS5nZXRTdGF0ZSgpKTtcclxuICAgICAgICBvcmRlcmVkRGlyZWN0aW9ucy5mb3JFYWNoKChkaXJlY3Rpb24pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29weVN0YXRlID0gY3VycmVudFN0YXRlXHJcbiAgICAgICAgICAgICAgICA/LmdldFN0YXRlKClcclxuICAgICAgICAgICAgICAgID8ubWFwKChyb3cpID0+IFsuLi5yb3ddKTtcclxuICAgICAgICAgICAgLy8gY29vcmRzIGNlbGwgdG8gc3dpdGNoXHJcbiAgICAgICAgICAgIGNvbnN0IGNvb3JkcyA9IHtcclxuICAgICAgICAgICAgICAgIHg6IGVtcHR5Q2VsbC54ICsgZGlyZWN0aW9uLngsXHJcbiAgICAgICAgICAgICAgICB5OiBlbXB0eUNlbGwueSArIGRpcmVjdGlvbi55LFxyXG4gICAgICAgICAgICAgICAgbmFtZTogZGlyZWN0aW9uLm5hbWUsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vIGlmIGNvb3JkcyBvZiBzd2FwcGVkIGNlbGwgaXMgbm90IG91dCB0aGUgYm9yZGVyIG9mIHRoZSBmaWVsZFxyXG4gICAgICAgICAgICBpZiAoIWlzT3V0T2ZCb3JkZXIoY29vcmRzKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gbW92ZSBlbXB0eSBjZWxsIGludG8gY3VycmVudCBkaXJlY3Rpb25cclxuICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICBjb3B5U3RhdGVbZW1wdHlDZWxsLnhdW2VtcHR5Q2VsbC55XSxcclxuICAgICAgICAgICAgICAgICAgICBjb3B5U3RhdGVbY29vcmRzLnhdW2Nvb3Jkcy55XSxcclxuICAgICAgICAgICAgICAgIF0gPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgY29weVN0YXRlW2Nvb3Jkcy54XVtjb29yZHMueV0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29weVN0YXRlW2VtcHR5Q2VsbC54XVtlbXB0eUNlbGwueV0sXHJcbiAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0cy5tb3ZlcysrO1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgc3dhcHBlZCBzdGF0ZSBpcyBub3QgcHJlc2VudCBpbiBkYXRhYmFzZVxyXG4gICAgICAgICAgICAgICAgaWYgKCFkYi5nZXQoY29weVN0YXRlLnRvU3RyaW5nKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVldWUucHVzaChuZXcgTm9kZShjb3B5U3RhdGUsIGN1cnJlbnRTdGF0ZSwgZGlyZWN0aW9uLm5hbWUsIGN1cnJlbnRTdGF0ZS5nZXREZXB0aCgpICsgMSwgMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRiLnNldChjb3B5U3RhdGUudG9TdHJpbmcoKSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVzLnB1c2goeyBzdGF0ZTogY29weVN0YXRlLCBpbmRleDogcmVzdWx0cy5tb3ZlcyArIDEgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgREZTKGZpbmFsLCBzdGF0ZXMsIGRiLCBxdWV1ZSwgb3JkZXJlZERpcmVjdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5kcm9wcGVkKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdGF0ZXM7XHJcbn07XHJcbigoKSA9PiB7XHJcbiAgICBsZXQgYWxsU3RhdGVzID0gW107XHJcbiAgICBjb25zdCBuZXh0U3RhdGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5leHRcIik7XHJcbiAgICBjb25zdCByZXN1bHRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc3VsdFwiKTtcclxuICAgIGNvbnN0IGZpbmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZpbmRcIik7XHJcbiAgICBjb25zdCByZXN1bHRDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHQtY29udGVudFwiKTtcclxuICAgIGxldCBpbmRleE9mTmV4dFN0YXRlID0gMDtcclxuICAgIGNvbnN0IHJlc3VsdHNXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN1bHRzXCIpO1xyXG4gICAgY29uc3QgdW5sb2NrQnV0dG9ucyA9ICgpID0+IHtcclxuICAgICAgICBuZXh0U3RhdGVCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICByZXN1bHRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH07XHJcbiAgICBjb25zdCBkaXNhYmxlQnV0dG9ucyA9ICgpID0+IHtcclxuICAgICAgICBuZXh0U3RhdGVCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIHJlc3VsdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgcHJpbnRSZXN1bHRzID0gKCkgPT4ge1xyXG4gICAgICAgIHJlc3VsdENvbnRlbnQuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICBpZiAoIXJlc3VsdHMuaGF2ZVNvbHV0aW9uKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0LLRltC00LLRltC00LDQvdC40YUg0YHRgtCw0L3RltCyOiAke3Jlc3VsdHMubW92ZXN9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0YHRgtCw0L3RltCyINC30LDQvdC10YHQtdC90LjRhSDRgyDQkdCUOiAke3Jlc3VsdHMuc2V0dGxlZH1gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYNCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQutC40L3Rg9GC0LjRhSDRgdGC0LDQvdGW0LI6ICR7cmVzdWx0cy5kcm9wcGVkfWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcItCT0YDQsCDRgyA4INC90LXQvNCw0ZQg0YDQvtC30LIn0Y/Qt9C60ZbQslwiKTtcclxuICAgICAgICAgICAgcmVzdWx0Q29udGVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgYFxuICAgICAgICAgICAgPGNvZGU+XG4gICAgICAgICAgICA8cHJlPtCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQstGW0LTQsNC90LjRhSDRgdGC0LDQvdGW0LIgOiAke3Jlc3VsdHMubW92ZXN9PGJyPtCa0ZbQu9GM0LrRltGB0YLRjCDRgdGC0LDQvdGW0LIg0LfQsNC90LXRgdC10L3QuNGFINGDINCR0JQgOiAke3Jlc3VsdHMuc2V0dGxlZH08YnI+0JrRltC70YzQutGW0YHRgtGMINCy0ZbQtNC60LjQvdGD0YLQuNGFINGB0YLQsNC90ZbQsiA6ICR7cmVzdWx0cy5kcm9wcGVkfTxicj7Qk9GA0LAg0YMgOCDQvdC10LzQsNGUINGA0L7Qt9CyJ9GP0LfQutGW0LI8L3ByZT5cbiAgICAgICAgICAgIDwvY29kZT5cbiAgICAgICAgIGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCLQn9C+0YDRj9C00L7QuiDQv9C10YDQtdC80ZbRidC10L3RjCDQtNC70Y8g0YDQvtC30LIn0Y/Qt9C60YMg0LPRgNC4INCyIDg6XCIpO1xyXG4gICAgICAgICAgICByZXN1bHRzPy5jdXJyZW50U3RhdGU/LnBhdGhGcm9tU3RhcnQoKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYNCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQstGW0LTQsNC90LjRhSDRgdGC0LDQvdGW0LI6ICR7cmVzdWx0cy5tb3Zlc31gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYNCa0ZbQu9GM0LrRltGB0YLRjCDRgdGC0LDQvdGW0LIg0LfQsNC90LXRgdC10L3QuNGFINGDINCR0JQ6ICR7cmVzdWx0cy5zZXR0bGVkfWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0JrRltC70YzQutGW0YHRgtGMINCy0ZbQtNC60LjQvdGD0YLQuNGFINGB0YLQsNC90ZbQsjogJHtyZXN1bHRzLmRyb3BwZWR9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQk9C70LjQsdC40L3QsCDQtNC10YDQtdCy0LAg0L/QvtGI0YPQutGDINC90LAg0Y/QutGW0Lkg0LfQvdCw0LnQtNC10L3QviDRgNGW0YjQtdC90L3RjzogJHtyZXN1bHRzLmRlcHRofWApO1xyXG4gICAgICAgICAgICByZXN1bHRDb250ZW50Lmluc2VydEFkamFjZW50SFRNTChcImJlZm9yZWVuZFwiLCBgXG4gICAgICAgICAgICA8Y29kZT5cbiAgICAgICAgICAgIDxwcmU+0JrRltC70YzQutGW0YHRgtGMINCy0ZbQtNCy0ZbQtNCw0L3QuNGFINGB0YLQsNC90ZbQsjogJHtyZXN1bHRzLm1vdmVzfTxicj7QmtGW0LvRjNC60ZbRgdGC0Ywg0YHRgtCw0L3RltCyINC30LDQvdC10YHQtdC90LjRhSDRgyDQkdCUOiAke3Jlc3VsdHMuc2V0dGxlZH08YnI+0JrRltC70YzQutGW0YHRgtGMINCy0ZbQtNC60LjQvdGD0YLQuNGFINGB0YLQsNC90ZbQsjogJHtyZXN1bHRzLmRyb3BwZWR9PGJyPtCT0LvQuNCx0LjQvdCwINC00LXRgNC10LLQsCDQv9C+0YjRg9C60YMg0L3QsCDRj9C60ZbQuSDQt9C90LDQudC00LXQvdC+INGA0ZbRiNC10L3QvdGPOiAke3Jlc3VsdHMuZGVwdGh9PC9wcmU+XG4gICAgICAgICAgICA8L2NvZGU+XG4gICAgICAgICBgKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZmluZFJlc3VsdHMgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZ2V0VGFibGVTdGF0ZSA9ICh0YWJsZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCByb3cgb2YgdGFibGUucm93cykge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhdGVSb3cgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGNlbGwgb2Ygcm93LmNlbGxzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbERhdGEgPSBwYXJzZUludChjZWxsLmlubmVySFRNTCk7XHJcbiAgICAgICAgICAgICAgICAgICAgTnVtYmVyLmlzTmFOKGNlbGxEYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHN0YXRlUm93LnB1c2gobnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiBzdGF0ZVJvdy5wdXNoKGNlbGxEYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN0YXRlLnB1c2goc3RhdGVSb3cpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxTdGF0ZVRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5pbml0aWFsLXN0YXRlXCIpO1xyXG4gICAgICAgIGNvbnN0IGZpbmFsU3RhdGVUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZmluYWwtc3RhdGVcIik7XHJcbiAgICAgICAgY29uc3QgaW5pdGlhbCA9IGdldFRhYmxlU3RhdGUoaW5pdGlhbFN0YXRlVGFibGUpO1xyXG4gICAgICAgIGNvbnN0IGZpbmFsID0gZ2V0VGFibGVTdGF0ZShmaW5hbFN0YXRlVGFibGUpO1xyXG4gICAgICAgIC8vIHJlc2V0IHN0ZXAgYnkgc3RlcCByZXN1bHRzIG91dHB1dFxyXG4gICAgICAgIGluZGV4T2ZOZXh0U3RhdGUgPSAwO1xyXG4gICAgICAgIHJlc3VsdHMgPSBDTEVBTl9SRVNVTFQ7XHJcbiAgICAgICAgcmVzdWx0c1dyYXBwZXIuaW5uZXJIVE1MID0gbnVsbDtcclxuICAgICAgICBjb25zdCBkYiA9IG5ldyBNYXAoKTtcclxuICAgICAgICBkYi5zZXQoaW5pdGlhbC50b1N0cmluZygpLCB0cnVlKTtcclxuICAgICAgICBjb25zdCBxdWV1ZSA9IFtuZXcgTm9kZShpbml0aWFsLCBudWxsLCBudWxsLCAwLCAwKV07XHJcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uTGVmdCA9IHBhcnNlSW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlyZWN0aW9ucy1sZWZ0XCIpPy50ZXh0Q29udGVudCk7XHJcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uVG9wID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaXJlY3Rpb25zLXRvcFwiKT8udGV4dENvbnRlbnQpO1xyXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvblJpZ2h0ID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaXJlY3Rpb25zLXJpZ2h0XCIpPy50ZXh0Q29udGVudCk7XHJcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uQm90dG9tID0gcGFyc2VJbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaXJlY3Rpb25zLWJvdHRvbVwiKT8udGV4dENvbnRlbnQpO1xyXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbkhUTUwgPSBbZGlyZWN0aW9uTGVmdCwgZGlyZWN0aW9uVG9wLCBkaXJlY3Rpb25SaWdodCwgZGlyZWN0aW9uQm90dG9tXTtcclxuICAgICAgICBjb25zdCBvcmRlcmVkRGlyZWN0aW9ucyA9IGRpcmVjdGlvbnMubWFwKChkaXJlY3Rpb24sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IC4uLmRpcmVjdGlvbiwgb3JkZXJJbmRleDogZGlyZWN0aW9uSFRNTFtpbmRleF0gfTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBvcmRlcmVkRGlyZWN0aW9ucy5zb3J0KChhLCBiKSA9PiBhLm9yZGVySW5kZXggLSBiLm9yZGVySW5kZXgpO1xyXG4gICAgICAgIGFsbFN0YXRlcyA9IERGUyhmaW5hbCwgW3sgc3RhdGU6IGluaXRpYWwsIGluZGV4OiAxIH1dLCBkYiwgcXVldWUsIG9yZGVyZWREaXJlY3Rpb25zKTtcclxuICAgICAgICB1bmxvY2tCdXR0b25zKCk7XHJcbiAgICB9O1xyXG4gICAgZGlzYWJsZUJ1dHRvbnMoKTtcclxuICAgIG5leHRTdGF0ZUJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICBpZiAoaW5kZXhPZk5leHRTdGF0ZSA+PSBhbGxTdGF0ZXMubGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICBuZXh0U3RhdGVCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBBZGQgbmV4dCBuZXcgc3RhdGUgdGFibGUgdG8gdGhlIHZpZXdcclxuICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcclxuICAgICAgICB0YWJsZS5jbGFzc05hbWUgKz1cclxuICAgICAgICAgICAgXCJ0YWJsZSB0YWJsZS1wcmltYXJ5IHRhYmxlLWhvdmVyIHRhYmxlLWJvcmRlcmVkIHRhYmxlLXNtIGFsaWduLW1pZGRsZSBjYXB0aW9uLXRvcFwiO1xyXG4gICAgICAgIHRhYmxlLnN0eWxlLndpZHRoID0gXCIyMDBweFwiO1xyXG4gICAgICAgIHRhYmxlLnN0eWxlLmhlaWdodCA9IFwiMjAwcHhcIjtcclxuICAgICAgICB0YWJsZS5zdHlsZS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgICAgIHRhYmxlLmluc2VydEFkamFjZW50SFRNTChcImFmdGVyYmVnaW5cIiwgYFxuICAgICAgICAgICAgPGNhcHRpb24gY2xhc3M9XCJmdy1ib2xkIHRleHQtcHJpbWFyeVwiPlxuICAgICAgICAgICAgICAgSW5kZXggb2YgdGhlIHN0YXRlIGlzICR7YWxsU3RhdGVzW2luZGV4T2ZOZXh0U3RhdGVdLmluZGV4fVxuICAgICAgICAgICAgPC9jYXB0aW9uPlxuICAgICAgICAgYCk7XHJcbiAgICAgICAgY29uc3QgdGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGJvZHlcIik7XHJcbiAgICAgICAgZm9yIChsZXQgcm93IG9mIGFsbFN0YXRlc1tpbmRleE9mTmV4dFN0YXRlXS5zdGF0ZSkge1xyXG4gICAgICAgICAgICBjb25zdCB0YWJsZVJvdyA9IHRib2R5Lmluc2VydFJvdygpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBjb2wgb2Ygcm93KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZCA9IHRhYmxlUm93Lmluc2VydENlbGwoKTtcclxuICAgICAgICAgICAgICAgIHRkLmNsYXNzTGlzdC5hZGQoXCJhbGlnbi1taWRkbGVcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRkLmlubmVySFRNTCA9IFwiIFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gU3RyaW5nKGNvbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQodGJvZHkpO1xyXG4gICAgICAgIHJlc3VsdHNXcmFwcGVyPy5hcHBlbmRDaGlsZCh0YWJsZSk7XHJcbiAgICAgICAgcmVzdWx0c1dyYXBwZXIuc2Nyb2xsVG9wID0gcmVzdWx0c1dyYXBwZXIuc2Nyb2xsSGVpZ2h0O1xyXG4gICAgICAgIC8vIHByaW50IHJlc3VsdHMgdG8gdGhlIGNvbnNvbGVcclxuICAgICAgICBkaXNwbGF5Qm9hcmQoYWxsU3RhdGVzW2luZGV4T2ZOZXh0U3RhdGVdLnN0YXRlLCBhbGxTdGF0ZXNbaW5kZXhPZk5leHRTdGF0ZV0uaW5kZXgpO1xyXG4gICAgICAgIGluZGV4T2ZOZXh0U3RhdGUrKztcclxuICAgIH0pO1xyXG4gICAgcmVzdWx0QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHByaW50UmVzdWx0cygpO1xyXG4gICAgfSk7XHJcbiAgICBmaW5kQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZmluZFJlc3VsdHMpO1xyXG4gICAgaW5wdXREZXB0aC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGZpbmRSZXN1bHRzKTtcclxufSkoKTtcclxuIl0sIm5hbWVzIjpbImRpcmVjdGlvbnMiLCJ4IiwieSIsIm5hbWUiLCJDTEVBTl9SRVNVTFQiLCJjdXJyZW50U3RhdGUiLCJtb3ZlcyIsInNldHRsZWQiLCJkcm9wcGVkIiwiZGVwdGgiLCJoYXZlU29sdXRpb24iLCJkaXNwbGF5Qm9hcmQiLCJzdGF0ZSIsImluZGV4IiwiZGVidWciLCJjb25zb2xlIiwibG9nIiwiZGlzcGxheSIsInJvdyIsImNlbGxzIiwibWFwIiwiaXRlbSIsImdldEVtcHlDZWxsQ29vcmRzIiwiY29vcmRpbmF0ZXMiLCJvdXRlciIsImkiLCJsZW5ndGgiLCJqIiwiaXNPdXRPZkJvcmRlciIsImNvb3JkcyIsIk5vZGUiLCJjb25zdHJ1Y3RvciIsInBhcmVudCIsIm9wZXJhdG9yIiwiY29zdCIsInRoaXMiLCJnZXRTdGF0ZSIsImdldE1vdmVzIiwiZ2V0RGVwdGgiLCJwYXRoRnJvbVN0YXJ0Iiwic3RhdGVMaXN0IiwibW92ZUxpc3QiLCJjdXJyZW50Tm9kZSIsInB1c2giLCJyZXZlcnNlIiwiam9pbiIsInJlc3VsdHMiLCJpbnB1dERlcHRoIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIkRGUyIsImZpbmFsIiwic3RhdGVzIiwiZGIiLCJxdWV1ZSIsIm9yZGVyZWREaXJlY3Rpb25zIiwicG9wIiwicGFyc2VJbnQiLCJ2YWx1ZSIsInNpemUiLCJzZWNvbmRTdGF0ZSIsInRvU3RyaW5nIiwiZW1wdHlDZWxsIiwiZm9yRWFjaCIsImRpcmVjdGlvbiIsImNvcHlTdGF0ZSIsImdldCIsInNldCIsImFsbFN0YXRlcyIsIm5leHRTdGF0ZUJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJyZXN1bHRCdXR0b24iLCJmaW5kQnV0dG9uIiwicmVzdWx0Q29udGVudCIsImluZGV4T2ZOZXh0U3RhdGUiLCJyZXN1bHRzV3JhcHBlciIsImZpbmRSZXN1bHRzIiwiZ2V0VGFibGVTdGF0ZSIsInRhYmxlIiwicm93cyIsInN0YXRlUm93IiwiY2VsbCIsImNlbGxEYXRhIiwiaW5uZXJIVE1MIiwiTnVtYmVyIiwiaXNOYU4iLCJpbml0aWFsU3RhdGVUYWJsZSIsImZpbmFsU3RhdGVUYWJsZSIsImluaXRpYWwiLCJNYXAiLCJkaXJlY3Rpb25IVE1MIiwidGV4dENvbnRlbnQiLCJvcmRlckluZGV4Iiwic29ydCIsImEiLCJiIiwiZGlzYWJsZWQiLCJhZGRFdmVudExpc3RlbmVyIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInN0eWxlIiwid2lkdGgiLCJoZWlnaHQiLCJ0ZXh0QWxpZ24iLCJpbnNlcnRBZGphY2VudEhUTUwiLCJ0Ym9keSIsInRhYmxlUm93IiwiaW5zZXJ0Um93IiwiY29sIiwidGQiLCJpbnNlcnRDZWxsIiwiY2xhc3NMaXN0IiwiYWRkIiwiU3RyaW5nIiwiYXBwZW5kQ2hpbGQiLCJzY3JvbGxUb3AiLCJzY3JvbGxIZWlnaHQiXSwic291cmNlUm9vdCI6IiJ9