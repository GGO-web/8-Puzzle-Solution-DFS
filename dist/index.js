(()=>{"use strict";const e=[{x:0,y:-1,name:"⇐"},{x:-1,y:0,name:"⇑"},{x:0,y:1,name:"⇒"},{x:1,y:0,name:"⇓"}],t={currentState:null,moves:0,settled:0,dropped:0,depth:0,haveSolution:!1},n=(e,t,n=!0)=>{console.log(`Index of the state ${t}`);let o="";for(let t of e){const e=t.map((e=>e||" "));o+="-------------\n",o+=`| ${e[0]} | ${e[1]} | ${e[2]} |\n`}return o+="-------------\n",n&&console.log(o),o},o=e=>{let t={x:0,y:0,name:"empty"};e:for(let n=0;n<e[0].length;++n)for(let o=0;o<e.length;++o)if(null===e[n][o]){t.x=n,t.y=o;break e}return t},s=e=>e.x>=3||e.x<0||e.y>=3||e.y<0;class l{constructor(e,t,o,s,l){this.getState=()=>this.state,this.getMoves=()=>this.operator,this.getDepth=()=>this.depth||1,this.pathFromStart=()=>{let e=[],t=[],o=this;do{e.push(o?.getState()),t.push(o?.getMoves()),o=o?.parent,o&&!o.parent&&e.push(o?.getState())}while(0!==o?.getDepth());e.reverse(),t.reverse();let s=1;for(const t of e)n(t,s),s++;return console.log(`Кількість переміщень: ${t.length}`),console.log(`Переміщення по порядку: ${t.join(", ")}\n`),t},this.state=e,this.parent=t,this.operator=o,this.depth=s,this.cost=l}}let r=t;const a=document.getElementById("game-depth"),d=function(t,n,c,i){for(;i.length;){let u=i.pop();if(u.getDepth()>=parseInt(a.value)||r.haveSolution)return n;if(r={...r,currentState:u,settled:c.size,depth:u.getDepth(),haveSolution:!1},p=u.getState(),h=t,p?.toString()===h?.toString())return r.haveSolution=!0,n;const g=o(u.getState());e.forEach((e=>{const o=u?.getState()?.map((e=>[...e])),a={x:g.x+e.x,y:g.y+e.y,name:e.name};s(a)||([o[g.x][g.y],o[a.x][a.y]]=[o[a.x][a.y],o[g.x][g.y]],r.moves++,c.get(o.toString())?r.dropped++:(i.push(new l(o,u,e.name,u.getDepth()+1,0)),c.set(o.toString(),!0),n.push({state:o,index:r.moves+1}),d(t,n,c,i)))}))}var p,h;return n};(()=>{let e=[];const o=document.querySelector(".next"),s=document.querySelector(".result"),c=document.querySelector(".find"),i=document.getElementById("result-content");let p=0;const h=document.getElementById("results"),u=()=>{const n=e=>{const t=[];for(let n of e.rows){const e=[];for(let t of n.cells){const n=parseInt(t.innerHTML);Number.isNaN(n)?e.push(null):e.push(n)}t.push(e)}return t},a=document.querySelector(".initial-state"),c=document.querySelector(".final-state"),i=n(a),u=n(c);p=0,r=t,h.innerHTML=null;const g=new Map;g.set(i.toString(),!0);const m=[new l(i,null,null,0,0)];e=d(u,[{state:i,index:1}],g,m),o.disabled=!1,s.disabled=!1};o.disabled=!0,s.disabled=!0,o?.addEventListener("click",(()=>{p>=e.length-1&&(o.disabled=!0);const t=document.createElement("table");t.className+="table table-primary table-hover table-bordered table-sm align-middle caption-top",t.style.width="200px",t.style.height="200px",t.style.textAlign="center",t.insertAdjacentHTML("afterbegin",`\n            <caption class="fw-bold text-primary">\n               Index of the state is ${e[p].index}\n            </caption>\n         `);const s=document.createElement("tbody");for(let t of e[p].state){const e=s.insertRow();for(let n of t){const t=e.insertCell();t.classList.add("align-middle"),t.innerHTML=n?String(n):" "}}t.appendChild(s),h?.appendChild(t),h.scrollTop=h.scrollHeight,n(e[p].state,e[p].index),p++})),s?.addEventListener("click",(()=>{i.innerHTML="",r.haveSolution?(console.log("Порядок переміщень для розв'язку гри в 8:"),console.log(`Кількість відвіданих станів: ${r.moves}`),console.log(`Кількість станів занесених у БД: ${r.settled}`),console.log(`Кількість відкинутих станів: ${r.dropped}`),console.log(`Глибина дерева пошуку на якій знайдено рішення: ${r.depth}`),i.insertAdjacentHTML("beforeend",`\n            <code>\n            <pre>Кількість відвіданих станів: ${r.moves}<br>Кількість станів занесених у БД: ${r.settled}<br>Кількість відкинутих станів: ${r.dropped}<br>Глибина дерева пошуку на якій знайдено рішення: ${r.depth}</pre>\n            </code>\n         `)):(console.log(`Кількість відвіданих станів: ${r.moves}`),console.log(`Кількість станів занесених у БД: ${r.settled}`),console.log(`Кількість відкинутих станів: ${r.dropped}`),console.log("Гра у 8 немає розв'язків"),i.insertAdjacentHTML("beforeend",`\n            <code>\n            <pre>Кількість відвіданих станів : ${r.moves}<br>Кількість станів занесених у БД : ${r.settled}<br>Кількість відкинутих станів : ${r.dropped}<br>Гра у 8 немає розв'язків</pre>\n            </code>\n         `))})),c?.addEventListener("click",u),a.addEventListener("change",u)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TyxRQUFRQyxJQUFJLDRCQUNad0QsRUFBY3lCLG1CQUFtQixZQUFhLHdFQUVUbkQsRUFBUXhDLDhDQUE4Q3dDLEVBQVF2Qyw0Q0FBNEN1QyxFQUFRdEMsNkVBc0Y3SSxJQUVsQitELEdBQVltQixpQkFBaUIsUUFBU2YsR0FDdEM1QixFQUFXMkMsaUJBQWlCLFNBQVVmLEVBQ3pDLEVBbkhELEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sYWIxLy4vc3JjL2NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9sYWIxLy4vc3JjL2hlbHBlcnMudHMiLCJ3ZWJwYWNrOi8vbGFiMS8uL3NyYy9ub2RlLnRzIiwid2VicGFjazovL2xhYjEvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGZpbmFsU3RhdGUgPSBbXHJcbiAgICBbMSwgMiwgM10sXHJcbiAgICBbNCwgNSwgNl0sXHJcbiAgICBbNywgOCwgbnVsbF0sXHJcbl07XHJcbmV4cG9ydCBjb25zdCBkaXJlY3Rpb25zID0gW1xyXG4gICAgeyB4OiAwLCB5OiAtMSwgbmFtZTogXCLih5BcIiB9LFxyXG4gICAgeyB4OiAtMSwgeTogMCwgbmFtZTogXCLih5FcIiB9LFxyXG4gICAgeyB4OiAwLCB5OiAxLCBuYW1lOiBcIuKHklwiIH0sXHJcbiAgICB7IHg6IDEsIHk6IDAsIG5hbWU6IFwi4oeTXCIgfSxcclxuXTtcclxuZXhwb3J0IGNvbnN0IE1BWF9ERVBUSF9TSVpFID0gMTMwMDtcclxuZXhwb3J0IGNvbnN0IENMRUFOX1JFU1VMVCA9IHtcclxuICAgIGN1cnJlbnRTdGF0ZTogbnVsbCxcclxuICAgIG1vdmVzOiAwLFxyXG4gICAgc2V0dGxlZDogMCxcclxuICAgIGRyb3BwZWQ6IDAsXHJcbiAgICBkZXB0aDogMCxcclxuICAgIGhhdmVTb2x1dGlvbjogZmFsc2UsXHJcbn07XHJcbiIsImV4cG9ydCBmdW5jdGlvbiogZ2V0RXhlY3V0aW9uVGltZSgpIHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICB5aWVsZCAxO1xyXG4gICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBjb25zdCBkaWZmID0gbmV3IERhdGUoZW5kVGltZSAtIHN0YXJ0VGltZSk7XHJcbiAgICBjb25zdCBleGVjdXRpb24gPSBkaWZmLmdldFNlY29uZHMoKSArIDAuMDAxICogZGlmZi5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgIGNvbnNvbGUubG9nKGBFeGVjdXRpb24gdGltZTogJHtleGVjdXRpb259IHNlY29uZHNgKTtcclxufVxyXG5leHBvcnQgY29uc3QgZGlzcGxheUJvYXJkID0gKHN0YXRlLCBpbmRleCwgZGVidWcgPSB0cnVlKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhgSW5kZXggb2YgdGhlIHN0YXRlICR7aW5kZXh9YCk7XHJcbiAgICBsZXQgZGlzcGxheSA9IFwiXCI7XHJcbiAgICBmb3IgKGxldCByb3cgb2Ygc3RhdGUpIHtcclxuICAgICAgICBjb25zdCBjZWxscyA9IHJvdy5tYXAoKGl0ZW0pID0+ICghaXRlbSA/IFwiIFwiIDogaXRlbSkpO1xyXG4gICAgICAgIGRpc3BsYXkgKz0gXCItLS0tLS0tLS0tLS0tXFxuXCI7XHJcbiAgICAgICAgZGlzcGxheSArPSBgfCAke2NlbGxzWzBdfSB8ICR7Y2VsbHNbMV19IHwgJHtjZWxsc1syXX0gfFxcbmA7XHJcbiAgICB9XHJcbiAgICBkaXNwbGF5ICs9IFwiLS0tLS0tLS0tLS0tLVxcblwiO1xyXG4gICAgaWYgKGRlYnVnKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGRpc3BsYXkpO1xyXG4gICAgcmV0dXJuIGRpc3BsYXk7XHJcbn07XHJcbmV4cG9ydCBjb25zdCBnZXRFbXB5Q2VsbENvb3JkcyA9IChzdGF0ZSkgPT4ge1xyXG4gICAgbGV0IGNvb3JkaW5hdGVzID0geyB4OiAwLCB5OiAwLCBuYW1lOiBcImVtcHR5XCIgfTtcclxuICAgIG91dGVyOiBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXRlWzBdLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzdGF0ZS5sZW5ndGg7ICsraikge1xyXG4gICAgICAgICAgICBpZiAoc3RhdGVbaV1bal0gPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzLnggPSBpO1xyXG4gICAgICAgICAgICAgICAgY29vcmRpbmF0ZXMueSA9IGo7XHJcbiAgICAgICAgICAgICAgICBicmVhayBvdXRlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBjb29yZGluYXRlcztcclxufTtcclxuZXhwb3J0IGNvbnN0IHN0YXRlc0FyZUVxdWFsID0gKHN0YXRlLCBzZWNvbmRTdGF0ZSkgPT4ge1xyXG4gICAgcmV0dXJuIHN0YXRlPy50b1N0cmluZygpID09PSBzZWNvbmRTdGF0ZT8udG9TdHJpbmcoKTtcclxufTtcclxuZXhwb3J0IGNvbnN0IGlzT3V0T2ZCb3JkZXIgPSAoY29vcmRzKSA9PiB7XHJcbiAgICBpZiAoY29vcmRzLnggPj0gMyB8fCBjb29yZHMueCA8IDApXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICBpZiAoY29vcmRzLnkgPj0gMyB8fCBjb29yZHMueSA8IDApXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn07XHJcbiIsImltcG9ydCB7IGRpc3BsYXlCb2FyZCB9IGZyb20gXCIuL2hlbHBlcnNcIjtcclxuZXhwb3J0IGNsYXNzIE5vZGUge1xyXG4gICAgY29uc3RydWN0b3Ioc3RhdGUsIHBhcmVudCwgb3BlcmF0b3IsIGRlcHRoLCBjb3N0KSB7XHJcbiAgICAgICAgdGhpcy5nZXRTdGF0ZSA9ICgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmdldE1vdmVzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVyYXRvcjtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZ2V0RGVwdGggPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlcHRoIHx8IDE7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnBhdGhGcm9tU3RhcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzdGF0ZUxpc3QgPSBbXTtcclxuICAgICAgICAgICAgbGV0IG1vdmVMaXN0ID0gW107XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50Tm9kZSA9IHRoaXM7XHJcbiAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgIHN0YXRlTGlzdC5wdXNoKGN1cnJlbnROb2RlPy5nZXRTdGF0ZSgpKTtcclxuICAgICAgICAgICAgICAgIG1vdmVMaXN0LnB1c2goY3VycmVudE5vZGU/LmdldE1vdmVzKCkpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudE5vZGUgPSBjdXJyZW50Tm9kZT8ucGFyZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlICYmICFjdXJyZW50Tm9kZS5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZUxpc3QucHVzaChjdXJyZW50Tm9kZT8uZ2V0U3RhdGUoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gd2hpbGUgKGN1cnJlbnROb2RlPy5nZXREZXB0aCgpICE9PSAwKTtcclxuICAgICAgICAgICAgc3RhdGVMaXN0LnJldmVyc2UoKTtcclxuICAgICAgICAgICAgbW92ZUxpc3QucmV2ZXJzZSgpO1xyXG4gICAgICAgICAgICBsZXQgaW5kZXggPSAxO1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygc3RhdGVMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5Qm9hcmQoaXRlbSwgaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0JrRltC70YzQutGW0YHRgtGMINC/0LXRgNC10LzRltGJ0LXQvdGMOiAke21vdmVMaXN0Lmxlbmd0aH1gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYNCf0LXRgNC10LzRltGJ0LXQvdC90Y8g0L/QviDQv9C+0YDRj9C00LrRgzogJHttb3ZlTGlzdC5qb2luKFwiLCBcIil9XFxuYCk7XHJcbiAgICAgICAgICAgIHJldHVybiBtb3ZlTGlzdDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgICAgICB0aGlzLm9wZXJhdG9yID0gb3BlcmF0b3I7XHJcbiAgICAgICAgdGhpcy5kZXB0aCA9IGRlcHRoO1xyXG4gICAgICAgIHRoaXMuY29zdCA9IGNvc3Q7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgQ0xFQU5fUkVTVUxULCBkaXJlY3Rpb25zIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IGRpc3BsYXlCb2FyZCwgZ2V0RW1weUNlbGxDb29yZHMsIGlzT3V0T2ZCb3JkZXIsIHN0YXRlc0FyZUVxdWFsLCB9IGZyb20gXCIuL2hlbHBlcnNcIjtcclxuaW1wb3J0IHsgTm9kZSB9IGZyb20gXCIuL25vZGVcIjtcclxubGV0IHJlc3VsdHMgPSBDTEVBTl9SRVNVTFQ7XHJcbmNvbnN0IGlucHV0RGVwdGggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWUtZGVwdGhcIik7XHJcbmNvbnN0IERGUyA9IGZ1bmN0aW9uIChmaW5hbCwgc3RhdGVzLCBkYiwgcXVldWUpIHtcclxuICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcclxuICAgICAgICBsZXQgY3VycmVudFN0YXRlID0gcXVldWUucG9wKCk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZS5nZXREZXB0aCgpID49IHBhcnNlSW50KGlucHV0RGVwdGgudmFsdWUpIHx8XHJcbiAgICAgICAgICAgIHJlc3VsdHMuaGF2ZVNvbHV0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc3VsdHMgPSB7XHJcbiAgICAgICAgICAgIC4uLnJlc3VsdHMsXHJcbiAgICAgICAgICAgIGN1cnJlbnRTdGF0ZTogY3VycmVudFN0YXRlLFxyXG4gICAgICAgICAgICBzZXR0bGVkOiBkYi5zaXplLFxyXG4gICAgICAgICAgICBkZXB0aDogY3VycmVudFN0YXRlLmdldERlcHRoKCksXHJcbiAgICAgICAgICAgIGhhdmVTb2x1dGlvbjogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoc3RhdGVzQXJlRXF1YWwoY3VycmVudFN0YXRlLmdldFN0YXRlKCksIGZpbmFsKSkge1xyXG4gICAgICAgICAgICByZXN1bHRzLmhhdmVTb2x1dGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGVtcHR5Q2VsbCA9IGdldEVtcHlDZWxsQ29vcmRzKGN1cnJlbnRTdGF0ZS5nZXRTdGF0ZSgpKTtcclxuICAgICAgICBkaXJlY3Rpb25zLmZvckVhY2goKGRpcmVjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb3B5U3RhdGUgPSBjdXJyZW50U3RhdGVcclxuICAgICAgICAgICAgICAgID8uZ2V0U3RhdGUoKVxyXG4gICAgICAgICAgICAgICAgPy5tYXAoKHJvdykgPT4gWy4uLnJvd10pO1xyXG4gICAgICAgICAgICAvLyBjb29yZHMgY2VsbCB0byBzd2l0Y2hcclxuICAgICAgICAgICAgY29uc3QgY29vcmRzID0ge1xyXG4gICAgICAgICAgICAgICAgeDogZW1wdHlDZWxsLnggKyBkaXJlY3Rpb24ueCxcclxuICAgICAgICAgICAgICAgIHk6IGVtcHR5Q2VsbC55ICsgZGlyZWN0aW9uLnksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBkaXJlY3Rpb24ubmFtZSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gaWYgY29vcmRzIG9mIHN3YXBwZWQgY2VsbCBpcyBub3Qgb3V0IHRoZSBib3JkZXIgb2YgdGhlIGZpZWxkXHJcbiAgICAgICAgICAgIGlmICghaXNPdXRPZkJvcmRlcihjb29yZHMpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIGVtcHR5IGNlbGwgaW50byBjdXJyZW50IGRpcmVjdGlvblxyXG4gICAgICAgICAgICAgICAgW1xyXG4gICAgICAgICAgICAgICAgICAgIGNvcHlTdGF0ZVtlbXB0eUNlbGwueF1bZW1wdHlDZWxsLnldLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvcHlTdGF0ZVtjb29yZHMueF1bY29vcmRzLnldLFxyXG4gICAgICAgICAgICAgICAgXSA9IFtcclxuICAgICAgICAgICAgICAgICAgICBjb3B5U3RhdGVbY29vcmRzLnhdW2Nvb3Jkcy55XSxcclxuICAgICAgICAgICAgICAgICAgICBjb3B5U3RhdGVbZW1wdHlDZWxsLnhdW2VtcHR5Q2VsbC55XSxcclxuICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICByZXN1bHRzLm1vdmVzKys7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBzd2FwcGVkIHN0YXRlIGlzIG5vdCBwcmVzZW50IGluIGRhdGFiYXNlXHJcbiAgICAgICAgICAgICAgICBpZiAoIWRiLmdldChjb3B5U3RhdGUudG9TdHJpbmcoKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWV1ZS5wdXNoKG5ldyBOb2RlKGNvcHlTdGF0ZSwgY3VycmVudFN0YXRlLCBkaXJlY3Rpb24ubmFtZSwgY3VycmVudFN0YXRlLmdldERlcHRoKCkgKyAxLCAwKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGIuc2V0KGNvcHlTdGF0ZS50b1N0cmluZygpLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZXMucHVzaCh7IHN0YXRlOiBjb3B5U3RhdGUsIGluZGV4OiByZXN1bHRzLm1vdmVzICsgMSB9KTtcclxuICAgICAgICAgICAgICAgICAgICBERlMoZmluYWwsIHN0YXRlcywgZGIsIHF1ZXVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZHJvcHBlZCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RhdGVzO1xyXG59O1xyXG4oKCkgPT4ge1xyXG4gICAgbGV0IGFsbFN0YXRlcyA9IFtdO1xyXG4gICAgY29uc3QgbmV4dFN0YXRlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5uZXh0XCIpO1xyXG4gICAgY29uc3QgcmVzdWx0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXN1bHRcIik7XHJcbiAgICBjb25zdCBmaW5kQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5maW5kXCIpO1xyXG4gICAgY29uc3QgcmVzdWx0Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0LWNvbnRlbnRcIik7XHJcbiAgICBsZXQgaW5kZXhPZk5leHRTdGF0ZSA9IDA7XHJcbiAgICBjb25zdCByZXN1bHRzV3JhcHBlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdWx0c1wiKTtcclxuICAgIGNvbnN0IHVubG9ja0J1dHRvbnMgPSAoKSA9PiB7XHJcbiAgICAgICAgbmV4dFN0YXRlQnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgcmVzdWx0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgY29uc3QgZGlzYWJsZUJ1dHRvbnMgPSAoKSA9PiB7XHJcbiAgICAgICAgbmV4dFN0YXRlQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICByZXN1bHRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgfTtcclxuICAgIGNvbnN0IHByaW50UmVzdWx0cyA9ICgpID0+IHtcclxuICAgICAgICByZXN1bHRDb250ZW50LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKCFyZXN1bHRzLmhhdmVTb2x1dGlvbikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0JrRltC70YzQutGW0YHRgtGMINCy0ZbQtNCy0ZbQtNCw0L3QuNGFINGB0YLQsNC90ZbQsjogJHtyZXN1bHRzLm1vdmVzfWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0JrRltC70YzQutGW0YHRgtGMINGB0YLQsNC90ZbQsiDQt9Cw0L3QtdGB0LXQvdC40YUg0YMg0JHQlDogJHtyZXN1bHRzLnNldHRsZWR9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0LLRltC00LrQuNC90YPRgtC40YUg0YHRgtCw0L3RltCyOiAke3Jlc3VsdHMuZHJvcHBlZH1gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCLQk9GA0LAg0YMgOCDQvdC10LzQsNGUINGA0L7Qt9CyJ9GP0LfQutGW0LJcIik7XHJcbiAgICAgICAgICAgIHJlc3VsdENvbnRlbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYmVmb3JlZW5kXCIsIGBcbiAgICAgICAgICAgIDxjb2RlPlxuICAgICAgICAgICAgPHByZT7QmtGW0LvRjNC60ZbRgdGC0Ywg0LLRltC00LLRltC00LDQvdC40YUg0YHRgtCw0L3RltCyIDogJHtyZXN1bHRzLm1vdmVzfTxicj7QmtGW0LvRjNC60ZbRgdGC0Ywg0YHRgtCw0L3RltCyINC30LDQvdC10YHQtdC90LjRhSDRgyDQkdCUIDogJHtyZXN1bHRzLnNldHRsZWR9PGJyPtCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQutC40L3Rg9GC0LjRhSDRgdGC0LDQvdGW0LIgOiAke3Jlc3VsdHMuZHJvcHBlZH08YnI+0JPRgNCwINGDIDgg0L3QtdC80LDRlCDRgNC+0LfQsifRj9C30LrRltCyPC9wcmU+XG4gICAgICAgICAgICA8L2NvZGU+XG4gICAgICAgICBgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi0J/QvtGA0Y/QtNC+0Log0L/QtdGA0LXQvNGW0YnQtdC90Ywg0LTQu9GPINGA0L7Qt9CyJ9GP0LfQutGDINCz0YDQuCDQsiA4OlwiKTtcclxuICAgICAgICAgICAgLy8gcmVzdWx0cz8uY3VycmVudFN0YXRlPy5wYXRoRnJvbVN0YXJ0KCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0LLRltC00LLRltC00LDQvdC40YUg0YHRgtCw0L3RltCyOiAke3Jlc3VsdHMubW92ZXN9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDQmtGW0LvRjNC60ZbRgdGC0Ywg0YHRgtCw0L3RltCyINC30LDQvdC10YHQtdC90LjRhSDRgyDQkdCUOiAke3Jlc3VsdHMuc2V0dGxlZH1gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYNCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQutC40L3Rg9GC0LjRhSDRgdGC0LDQvdGW0LI6ICR7cmVzdWx0cy5kcm9wcGVkfWApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg0JPQu9C40LHQuNC90LAg0LTQtdGA0LXQstCwINC/0L7RiNGD0LrRgyDQvdCwINGP0LrRltC5INC30L3QsNC50LTQtdC90L4g0YDRltGI0LXQvdC90Y86ICR7cmVzdWx0cy5kZXB0aH1gKTtcclxuICAgICAgICAgICAgcmVzdWx0Q29udGVudC5pbnNlcnRBZGphY2VudEhUTUwoXCJiZWZvcmVlbmRcIiwgYFxuICAgICAgICAgICAgPGNvZGU+XG4gICAgICAgICAgICA8cHJlPtCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQstGW0LTQsNC90LjRhSDRgdGC0LDQvdGW0LI6ICR7cmVzdWx0cy5tb3Zlc308YnI+0JrRltC70YzQutGW0YHRgtGMINGB0YLQsNC90ZbQsiDQt9Cw0L3QtdGB0LXQvdC40YUg0YMg0JHQlDogJHtyZXN1bHRzLnNldHRsZWR9PGJyPtCa0ZbQu9GM0LrRltGB0YLRjCDQstGW0LTQutC40L3Rg9GC0LjRhSDRgdGC0LDQvdGW0LI6ICR7cmVzdWx0cy5kcm9wcGVkfTxicj7Qk9C70LjQsdC40L3QsCDQtNC10YDQtdCy0LAg0L/QvtGI0YPQutGDINC90LAg0Y/QutGW0Lkg0LfQvdCw0LnQtNC10L3QviDRgNGW0YjQtdC90L3RjzogJHtyZXN1bHRzLmRlcHRofTwvcHJlPlxuICAgICAgICAgICAgPC9jb2RlPlxuICAgICAgICAgYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGZpbmRSZXN1bHRzID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGdldFRhYmxlU3RhdGUgPSAodGFibGUpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgcm93IG9mIHRhYmxlLnJvd3MpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlUm93ID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjZWxsIG9mIHJvdy5jZWxscykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxEYXRhID0gcGFyc2VJbnQoY2VsbC5pbm5lckhUTUwpO1xyXG4gICAgICAgICAgICAgICAgICAgIE51bWJlci5pc05hTihjZWxsRGF0YSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBzdGF0ZVJvdy5wdXNoKG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogc3RhdGVSb3cucHVzaChjZWxsRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzdGF0ZS5wdXNoKHN0YXRlUm93KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBpbml0aWFsU3RhdGVUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW5pdGlhbC1zdGF0ZVwiKTtcclxuICAgICAgICBjb25zdCBmaW5hbFN0YXRlVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZpbmFsLXN0YXRlXCIpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWwgPSBnZXRUYWJsZVN0YXRlKGluaXRpYWxTdGF0ZVRhYmxlKTtcclxuICAgICAgICBjb25zdCBmaW5hbCA9IGdldFRhYmxlU3RhdGUoZmluYWxTdGF0ZVRhYmxlKTtcclxuICAgICAgICAvLyByZXNldCBzdGVwIGJ5IHN0ZXAgcmVzdWx0cyBvdXRwdXRcclxuICAgICAgICBpbmRleE9mTmV4dFN0YXRlID0gMDtcclxuICAgICAgICByZXN1bHRzID0gQ0xFQU5fUkVTVUxUO1xyXG4gICAgICAgIHJlc3VsdHNXcmFwcGVyLmlubmVySFRNTCA9IG51bGw7XHJcbiAgICAgICAgY29uc3QgZGIgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgZGIuc2V0KGluaXRpYWwudG9TdHJpbmcoKSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgcXVldWUgPSBbbmV3IE5vZGUoaW5pdGlhbCwgbnVsbCwgbnVsbCwgMCwgMCldO1xyXG4gICAgICAgIGFsbFN0YXRlcyA9IERGUyhmaW5hbCwgW3sgc3RhdGU6IGluaXRpYWwsIGluZGV4OiAxIH1dLCBkYiwgcXVldWUpO1xyXG4gICAgICAgIHVubG9ja0J1dHRvbnMoKTtcclxuICAgIH07XHJcbiAgICBkaXNhYmxlQnV0dG9ucygpO1xyXG4gICAgbmV4dFN0YXRlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIGlmIChpbmRleE9mTmV4dFN0YXRlID49IGFsbFN0YXRlcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgIG5leHRTdGF0ZUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFkZCBuZXh0IG5ldyBzdGF0ZSB0YWJsZSB0byB0aGUgdmlld1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xyXG4gICAgICAgIHRhYmxlLmNsYXNzTmFtZSArPVxyXG4gICAgICAgICAgICBcInRhYmxlIHRhYmxlLXByaW1hcnkgdGFibGUtaG92ZXIgdGFibGUtYm9yZGVyZWQgdGFibGUtc20gYWxpZ24tbWlkZGxlIGNhcHRpb24tdG9wXCI7XHJcbiAgICAgICAgdGFibGUuc3R5bGUud2lkdGggPSBcIjIwMHB4XCI7XHJcbiAgICAgICAgdGFibGUuc3R5bGUuaGVpZ2h0ID0gXCIyMDBweFwiO1xyXG4gICAgICAgIHRhYmxlLnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgdGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKFwiYWZ0ZXJiZWdpblwiLCBgXG4gICAgICAgICAgICA8Y2FwdGlvbiBjbGFzcz1cImZ3LWJvbGQgdGV4dC1wcmltYXJ5XCI+XG4gICAgICAgICAgICAgICBJbmRleCBvZiB0aGUgc3RhdGUgaXMgJHthbGxTdGF0ZXNbaW5kZXhPZk5leHRTdGF0ZV0uaW5kZXh9XG4gICAgICAgICAgICA8L2NhcHRpb24+XG4gICAgICAgICBgKTtcclxuICAgICAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0Ym9keVwiKTtcclxuICAgICAgICBmb3IgKGxldCByb3cgb2YgYWxsU3RhdGVzW2luZGV4T2ZOZXh0U3RhdGVdLnN0YXRlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhYmxlUm93ID0gdGJvZHkuaW5zZXJ0Um93KCk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGNvbCBvZiByb3cpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gdGFibGVSb3cuaW5zZXJ0Q2VsbCgpO1xyXG4gICAgICAgICAgICAgICAgdGQuY2xhc3NMaXN0LmFkZChcImFsaWduLW1pZGRsZVwiKTtcclxuICAgICAgICAgICAgICAgIGlmICghY29sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuaW5uZXJIVE1MID0gXCIgXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZC5pbm5lckhUTUwgPSBTdHJpbmcoY29sKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZCh0Ym9keSk7XHJcbiAgICAgICAgcmVzdWx0c1dyYXBwZXI/LmFwcGVuZENoaWxkKHRhYmxlKTtcclxuICAgICAgICByZXN1bHRzV3JhcHBlci5zY3JvbGxUb3AgPSByZXN1bHRzV3JhcHBlci5zY3JvbGxIZWlnaHQ7XHJcbiAgICAgICAgLy8gcHJpbnQgcmVzdWx0cyB0byB0aGUgY29uc29sZVxyXG4gICAgICAgIGRpc3BsYXlCb2FyZChhbGxTdGF0ZXNbaW5kZXhPZk5leHRTdGF0ZV0uc3RhdGUsIGFsbFN0YXRlc1tpbmRleE9mTmV4dFN0YXRlXS5pbmRleCk7XHJcbiAgICAgICAgaW5kZXhPZk5leHRTdGF0ZSsrO1xyXG4gICAgfSk7XHJcbiAgICByZXN1bHRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgcHJpbnRSZXN1bHRzKCk7XHJcbiAgICB9KTtcclxuICAgIGZpbmRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmaW5kUmVzdWx0cyk7XHJcbiAgICBpbnB1dERlcHRoLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZmluZFJlc3VsdHMpO1xyXG59KSgpO1xyXG4iXSwibmFtZXMiOlsiZGlyZWN0aW9ucyIsIngiLCJ5IiwibmFtZSIsIkNMRUFOX1JFU1VMVCIsImN1cnJlbnRTdGF0ZSIsIm1vdmVzIiwic2V0dGxlZCIsImRyb3BwZWQiLCJkZXB0aCIsImhhdmVTb2x1dGlvbiIsImRpc3BsYXlCb2FyZCIsInN0YXRlIiwiaW5kZXgiLCJkZWJ1ZyIsImNvbnNvbGUiLCJsb2ciLCJkaXNwbGF5Iiwicm93IiwiY2VsbHMiLCJtYXAiLCJpdGVtIiwiZ2V0RW1weUNlbGxDb29yZHMiLCJjb29yZGluYXRlcyIsIm91dGVyIiwiaSIsImxlbmd0aCIsImoiLCJpc091dE9mQm9yZGVyIiwiY29vcmRzIiwiTm9kZSIsImNvbnN0cnVjdG9yIiwicGFyZW50Iiwib3BlcmF0b3IiLCJjb3N0IiwidGhpcyIsImdldFN0YXRlIiwiZ2V0TW92ZXMiLCJnZXREZXB0aCIsInBhdGhGcm9tU3RhcnQiLCJzdGF0ZUxpc3QiLCJtb3ZlTGlzdCIsImN1cnJlbnROb2RlIiwicHVzaCIsInJldmVyc2UiLCJqb2luIiwicmVzdWx0cyIsImlucHV0RGVwdGgiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiREZTIiwiZmluYWwiLCJzdGF0ZXMiLCJkYiIsInF1ZXVlIiwicG9wIiwicGFyc2VJbnQiLCJ2YWx1ZSIsInNpemUiLCJzZWNvbmRTdGF0ZSIsInRvU3RyaW5nIiwiZW1wdHlDZWxsIiwiZm9yRWFjaCIsImRpcmVjdGlvbiIsImNvcHlTdGF0ZSIsImdldCIsInNldCIsImFsbFN0YXRlcyIsIm5leHRTdGF0ZUJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJyZXN1bHRCdXR0b24iLCJmaW5kQnV0dG9uIiwicmVzdWx0Q29udGVudCIsImluZGV4T2ZOZXh0U3RhdGUiLCJyZXN1bHRzV3JhcHBlciIsImZpbmRSZXN1bHRzIiwiZ2V0VGFibGVTdGF0ZSIsInRhYmxlIiwicm93cyIsInN0YXRlUm93IiwiY2VsbCIsImNlbGxEYXRhIiwiaW5uZXJIVE1MIiwiTnVtYmVyIiwiaXNOYU4iLCJpbml0aWFsU3RhdGVUYWJsZSIsImZpbmFsU3RhdGVUYWJsZSIsImluaXRpYWwiLCJNYXAiLCJkaXNhYmxlZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsInRleHRBbGlnbiIsImluc2VydEFkamFjZW50SFRNTCIsInRib2R5IiwidGFibGVSb3ciLCJpbnNlcnRSb3ciLCJjb2wiLCJ0ZCIsImluc2VydENlbGwiLCJjbGFzc0xpc3QiLCJhZGQiLCJTdHJpbmciLCJhcHBlbmRDaGlsZCIsInNjcm9sbFRvcCIsInNjcm9sbEhlaWdodCJdLCJzb3VyY2VSb290IjoiIn0=